<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catálogo de Productos</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    .card { border: 1px solid #ccc; padding: 10px; margin: 10px; display: inline-block; width: 200px; vertical-align: top; }
    .card img { width: 100%; height: auto; }
    input { margin: 5px 0; width: 100%; padding: 5px; }
    button { padding: 5px 10px; margin-top: 5px; cursor: pointer; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>

  <!-- Login admin -->
  <div id="login">
    <h2>Login Admin</h2>
    <input type="text" id="username" placeholder="Usuario">
    <input type="password" id="password" placeholder="Contraseña">
    <button onclick="login()">Entrar</button>
  </div>

  <!-- Todos pueden ver esto -->
  <h1>Catálogo de Productos</h1>
  <input type="text" id="search" placeholder="Buscar producto..." oninput="filtrarProductos()">
  <div id="productos"></div>

  <!-- Panel admin -->
  <div id="adminPanel" class="hidden">
    <h2>Agregar Producto</h2>
    <input type="text" id="nombre" placeholder="Nombre">
    <input type="text" id="precio" placeholder="Precio">
    <input type="text" id="descripcion" placeholder="Descripción">
    <input type="text" id="foto" placeholder="URL de Imagen">
    <button onclick="agregarProducto()">Agregar Producto</button>
  </div>

  <!-- Panel editar producto -->
  <div id="editPanel" class="hidden">
    <h2>Editar Producto</h2>
    <input type="text" id="editNombre" placeholder="Nombre">
    <input type="text" id="editPrecio" placeholder="Precio">
    <input type="text" id="editDescripcion" placeholder="Descripción">
    <input type="text" id="editFoto" placeholder="URL de Imagen">
    <button onclick="guardarEdicion()">Guardar Cambios</button>
    <button onclick="cancelarEdicion()">Cancelar</button>
  </div>

  <script>
    // --------------------
    // Configuración Firebase
    // --------------------
    const firebaseConfig = {
      apiKey: "AIzaSyB8CdmsQ4GUqN1m_KlHlxGhagmed8_aVpA",
      authDomain: "producto-a6e68.firebaseapp.com",
      projectId: "producto-a6e68",
      storageBucket: "producto-a6e68.appspot.com",
      messagingSenderId: "358261871993",
      appId: "1:358261871993:web:6aff27584ed1afd7d04ba8"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // --------------------
    // Admin
    // --------------------
    const USER = "Belen192226";
    const PASS = "Fran192226";

    function login() {
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;
      if(user === USER && pass === PASS) {
        document.getElementById("login").classList.add("hidden");
        document.getElementById("adminPanel").classList.remove("hidden");
        mostrarProductos(true);
      } else {
        alert("Usuario o contraseña incorrectos");
      }
    }

    // --------------------
    // Mostrar productos
    // --------------------
    let productosData = [];
    let editId = null; // guardamos el id del producto a editar

    db.collection("productos").onSnapshot((querySnapshot) => {
      productosData = [];
      querySnapshot.forEach((doc) => {
        productosData.push({ id: doc.id, ...doc.data() });
      });
      renderizarProductos();
    });

    function renderizarProductos(filtro="") {
      const contenedor = document.getElementById("productos");
      const isAdmin = !document.getElementById("adminPanel").classList.contains("hidden");
      contenedor.innerHTML = "";
      productosData
        .filter(p => p.name.toLowerCase().includes(filtro.toLowerCase()))
        .forEach((p) => {
          contenedor.innerHTML += `
            <div class="card">
              <img src="${p.photo}" alt="${p.name}">
              <h3>${p.name}</h3>
              <p>${p.description}</p>
              <p><b>$${p.price}</b></p>
              ${isAdmin ? `
                <button onclick="editarProducto('${p.id}')">Editar</button>
                <button onclick="eliminarProducto('${p.id}')">Eliminar</button>
              ` : ""}
            </div>
          `;
        });
    }

    // --------------------
    // Agregar producto
    // --------------------
    function agregarProducto() {
      const nombre = document.getElementById("nombre").value.trim();
      const precio = document.getElementById("precio").value.trim();
      const descripcion = document.getElementById("descripcion").value.trim();
      const foto = document.getElementById("foto").value.trim();
      if(!nombre || !precio || !descripcion || !foto) {
        alert("Completa todos los campos");
        return;
      }
      db.collection("productos").add({
        name: nombre,
        price: parseFloat(precio),
        description: descripcion,
        photo: foto
      })
      .then(() => {
        alert("Producto agregado correctamente");
        document.getElementById("nombre").value = "";
        document.getElementById("precio").value = "";
        document.getElementById("descripcion").value = "";
        document.getElementById("foto").value = "";
      })
      .catch(err => console.error("Error:", err));
    }

    // --------------------
    // Eliminar producto
    // --------------------
    function eliminarProducto(id) {
      db.collection("productos").doc(id).delete()
        .then(() => console.log("Producto eliminado"))
        .catch(err => console.error("Error:", err));
    }

    // --------------------
    // Editar producto
    // --------------------
    function editarProducto(id) {
      const producto = productosData.find(p => p.id === id);
      if(!producto) return;
      editId = id;
      document.getElementById("editNombre").value = producto.name;
      document.getElementById("editPrecio").value = producto.price;
      document.getElementById("editDescripcion").value = producto.description;
      document.getElementById("editFoto").value = producto.photo;

      document.getElementById("editPanel").classList.remove("hidden");
    }

    function guardarEdicion() {
      const nombre = document.getElementById("editNombre").value.trim();
      const precio = document.getElementById("editPrecio").value.trim();
      const descripcion = document.getElementById("editDescripcion").value.trim();
      const foto = document.getElementById("editFoto").value.trim();
      if(!nombre || !precio || !descripcion || !foto) {
        alert("Completa todos los campos");
        return;
      }
      db.collection("productos").doc(editId).update({
        name: nombre,
        price: parseFloat(precio),
        description: descripcion,
        photo: foto
      })
      .then(() => {
        alert("Producto actualizado correctamente");
        cancelarEdicion();
      })
      .catch(err => console.error("Error:", err));
    }

    function cancelarEdicion() {
      editId = null;
      document.getElementById("editPanel").classList.add("hidden");
    }

    // --------------------
    // Filtrar productos
    // --------------------
    function filtrarProductos() {
      const valor = document.getElementById("search").value;
      renderizarProductos(valor);
    }

    // --------------------
    // Inicializar catálogo
    // --------------------
    renderizarProductos();
  </script>

</body>
</html>
